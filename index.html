<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="light">
    <title>184 Productions</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f5f0;
            color: #1a1a1a;
            overflow-x: hidden;
            font-weight: 300;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 16px;
            }
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-screen h1 {
            font-size: 18px;
            font-weight: 500;
            font-family: 'Adobe Garamond', serif;
            margin-bottom: 60px;
            text-align: center;
            color: #1a1a1a;
        }

        @media (min-width: 769px) {
            .login-screen h1 {
                font-size: 22px;
            }
        }

        .login-form {
            width: 100%;
            max-width: 360px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .user-option {
            width: 100%;
            padding: 16px 0;
            font-size: 14px;
            font-weight: 300;
            letter-spacing: 0.5px;
            background: transparent;
            border: 1px solid #d0d0c8;
            color: #1a1a1a;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Roboto', sans-serif;
        }

        .user-option:hover {
            background: #1a1a1a;
            color: #f5f5f0;
            border-color: #1a1a1a;
        }

        .user-option:active {
            opacity: 0.6;
        }
        
        /* Main App */
        .app {
            display: none;
            min-height: 100vh;
        }

        .app.active {
            display: block;
        }

        .header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #d0d0c8;
            gap: 16px;
        }

        .header h1 {
            font-size: 18px;
            font-weight: 500;
            font-family: 'Adobe Garamond', serif;
            color: #1a1a1a;
            text-align: center;
        }

        .header-left {
            position: absolute;
            left: 20px;
        }

        .header-nav {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        @media (min-width: 769px) {
            .header {
                display: grid;
                grid-template-columns: 1fr auto 1fr;
                align-items: center;
                margin-bottom: 80px;
                gap: 0;
            }

            .header h1 {
                font-size: 22px;
                grid-column: 2;
            }

            .header-left {
                position: static;
                grid-column: 1;
                justify-self: start;
            }

            .header-nav {
                grid-column: 3;
                justify-self: end;
            }
        }

        .user-name {
            font-size: 11px;
            font-weight: 300;
            color: #666;
            letter-spacing: 1px;
        }

        .nav-btn {
            padding: 8px 20px;
            background: transparent;
            border: 1px solid #1a1a1a;
            color: #1a1a1a;
            font-size: 10px;
            font-weight: 400;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Roboto', sans-serif;
        }

        .nav-btn:hover {
            background: #1a1a1a;
            color: #f5f5f0;
        }

        .nav-btn.active {
            background: #1a1a1a;
            color: #f5f5f0;
        }
        
        .movie-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 40px;
        }

        @media (min-width: 769px) {
            .movie-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 30px;
            }
        }

        .movie-card {
            cursor: pointer;
            transition: opacity 0.3s;
            width: 100%;
            aspect-ratio: 2/3;
        }

        .movie-card:hover {
            opacity: 0.7;
        }

        .movie-card:active {
            opacity: 0.5;
        }

        .poster {
            width: 100%;
            height: 100%;
            background: #e8e8e0;
            overflow: hidden;
            position: relative;
            border: 1px solid #d0d0c8;
        }

        .poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .vote-badge {
            position: absolute;
            top: 0;
            right: 0;
            padding: 8px 12px;
            font-size: 9px;
            font-weight: 400;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            background: #1a1a1a;
            color: #f5f5f0;
        }

        .vote-badge.yes {
            background: #1a1a1a;
        }

        .vote-badge.maybe {
            background: #666;
        }

        .vote-badge.veto {
            background: #999;
        }

        .movie-title {
            margin-top: 12px;
            font-size: 12px;
            font-weight: 300;
            letter-spacing: 0.0px;
            line-height: 1.4;
        }

        @media (min-width: 769px) {
            .movie-title {
                font-size: 13px;
            }
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(245, 245, 240, 0.98);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            max-width: 500px;
            width: 100%;
            margin: 20px;
            padding: 40px 20px;
        }

        @media (min-width: 769px) {
            .modal-content {
                max-width: 600px;
                padding: 60px 40px;
            }
        }

        .modal-poster {
            width: 100%;
            max-width: 280px;
            margin: 0 auto 32px;
            overflow: hidden;
            border: 1px solid #d0d0c8;
        }

        @media (min-width: 769px) {
            .modal-poster {
                max-width: 320px;
                margin-bottom: 40px;
            }
        }

        .modal-poster img {
            width: 100%;
            display: block;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 400;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
            text-align: center;
        }

        @media (min-width: 769px) {
            .modal-title {
                font-size: 22px;
            }
        }

        .modal-info {
            font-size: 12px;
            font-weight: 300;
            color: #666;
            margin-bottom: 32px;
            text-align: center;
            letter-spacing: 1px;
        }

        .modal-description {
            display: flex;
            flex-direction: column;
            gap: 24px;
            margin-bottom: 40px;
        }

        @media (min-width: 769px) {
            .modal-description {
                flex-direction: row;
                gap: 40px;
            }
        }

        .modal-column {
            flex: 1;
        }

        .modal-column h3 {
            font-size: 10px;
            font-weight: 400;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: #999;
            margin-bottom: 12px;
        }

        .modal-column p {
            font-size: 14px;
            font-weight: 300;
            line-height: 1.8;
            color: #333;
            text-align: left;
        }

        @media (min-width: 769px) {
            .modal-column p {
                font-size: 14px;
            }
        }

        .vote-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        @media (min-width: 769px) {
            .vote-buttons {
                flex-direction: row;
                gap: 16px;
            }
        }

        .vote-btn {
            flex: 1;
            padding: 14px 24px;
            border: 1px solid #1a1a1a;
            background: transparent;
            font-size: 10px;
            font-weight: 400;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Roboto', sans-serif;
            color: #1a1a1a;
        }

        .vote-btn:hover {
            background: #1a1a1a;
            color: #f5f5f0;
        }

        .vote-btn:active {
            opacity: 0.6;
        }

        .vote-btn.selected {
            background: #1a1a1a;
            color: #f5f5f0;
        }

        .vote-btn.yes:hover,
        .vote-btn.yes.selected {
            background: #1a1a1a;
        }

        .vote-btn.maybe:hover,
        .vote-btn.maybe.selected {
            background: #666;
            border-color: #666;
        }

        .vote-btn.veto:hover,
        .vote-btn.veto.selected {
            background: #999;
            border-color: #999;
        }

        .close-btn {
            width: 100%;
            padding: 14px;
            background: transparent;
            border: none;
            color: #999;
            font-size: 10px;
            font-weight: 300;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            cursor: pointer;
            transition: color 0.3s;
            font-family: 'Roboto', sans-serif;
        }

        .close-btn:hover {
            color: #1a1a1a;
        }

        /* Results View */
        .results-view {
            display: none;
        }

        .results-view.active {
            display: block;
        }

        .results-grid {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .results-movie {
            display: grid;
            grid-template-columns: 60px 1fr;
            gap: 16px;
            align-items: center;
        }

        @media (min-width: 769px) {
            .results-movie {
                grid-template-columns: 80px 1fr;
                gap: 20px;
            }
        }

        .results-poster {
            width: 100%;
            aspect-ratio: 2/3;
            background: #e8e8e0;
            overflow: hidden;
            border: 1px solid #d0d0c8;
        }

        .results-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .results-bars {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .results-bar {
            display: grid;
            grid-template-columns: 60px 1fr 40px;
            gap: 12px;
            align-items: center;
        }

        @media (min-width: 769px) {
            .results-bar {
                grid-template-columns: 80px 1fr 50px;
                gap: 16px;
            }
        }

        .bar-label {
            font-size: 10px;
            font-weight: 300;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: #666;
        }

        .bar-track {
            height: 8px;
            background: #e8e8e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .bar-fill.yes {
            background: #1a1a1a;
        }

        .bar-fill.maybe {
            background: #666;
        }

        .bar-fill.veto {
            background: #999;
        }

        .bar-count {
            font-size: 14px;
            font-weight: 300;
            color: #1a1a1a;
            text-align: right;
        }

        /* Suggestion Card */
        .suggestion-card {
            width: 100%;
            aspect-ratio: 2/3;
            background: #e8e8e0;
            border: 1px solid #d0d0c8;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            gap: 16px;
        }

        .suggestion-card h3 {
            font-size: 16px;
            font-weight: 400;
            letter-spacing: 0.5px;
            color: #1a1a1a;
            margin-bottom: 20px;
            text-align: center;
        }

        .suggestion-card input,
        .suggestion-card textarea {
            width: 100%;
            padding: 8px 0;
            font-size: 13px;
            font-weight: 300;
            background: transparent;
            border: none;
            border-bottom: 1px solid #ccc;
            color: #1a1a1a;
            font-family: 'Roboto', sans-serif;
        }

        .suggestion-card textarea {
            resize: none;
            line-height: 1.8;
            margin-top: 52px;
            padding: 0;
            border-bottom: none;
            background-image: repeating-linear-gradient(
                transparent,
                transparent 1.8em,
                #ccc 1.8em,
                #ccc calc(1.8em + 1px)
            );
            background-size: 100% 100%;
        }

        .suggestion-card input::placeholder,
        .suggestion-card textarea::placeholder {
            color: #999;
            font-weight: 200;
            font-style: italic;
        }

        .suggestion-card input:focus,
        .suggestion-card textarea:focus {
            outline: none;
        }

        .suggestion-card input:focus {
            border-bottom-color: #666;
        }

        .suggestion-card button {
            padding: 12px 0;
            font-size: 10px;
            font-weight: 400;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            background: #1a1a1a;
            border: none;
            color: #f5f5f0;
            cursor: pointer;
            transition: opacity 0.3s;
            font-family: 'Roboto', sans-serif;
            margin-top: auto;
            margin-bottom: 8px;
        }

        .suggestion-card button:hover {
            opacity: 0.8;
        }

        /* Suggestions in Results */
        .suggestions-section {
            margin-top: 60px;
            padding-top: 60px;
            border-top: 1px solid #d0d0c8;
        }

        .suggestions-section h2 {
            font-size: 14px;
            font-weight: 400;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: #999;
            margin-bottom: 40px;
            text-align: center;
        }

        .suggestion-item {
            padding: 20px 0;
            border-bottom: 1px solid #d0d0c8;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-title {
            font-size: 16px;
            font-weight: 400;
            margin-bottom: 8px;
            color: #1a1a1a;
        }

        .suggestion-reason {
            font-size: 13px;
            font-weight: 300;
            line-height: 1.6;
            color: #666;
            margin-bottom: 8px;
        }

        .suggestion-author {
            font-size: 11px;
            font-weight: 300;
            color: #999;
            font-style: italic;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-form">
            <button class="user-option" onclick="login('Sandy')">Sandy</button>
            <button class="user-option" onclick="login('Aaron')">Aaron</button>
            <button class="user-option" onclick="login('Cynthia')">Cynthia</button>
            <button class="user-option" onclick="login('Andres')">Andres</button>
        </div>
    </div>

    <!-- Main App -->
    <div class="app" id="app">
        <div class="container">
            <div class="header">
                <div class="header-left">
                    <span class="user-name" id="userName"></span>
                </div>
                <h1>184 Productions</h1>
                <div class="header-nav">
                    <button class="nav-btn active" id="moviesBtn" onclick="showMovies()">Movies</button>
                    <button class="nav-btn" id="resultsBtn" onclick="showResults()">Results</button>
                    <button class="nav-btn" onclick="logout()">Logout</button>
                </div>
            </div>

            <div class="movie-grid" id="movieGrid"></div>

            <div class="results-view" id="resultsView">
                <div class="results-grid" id="resultsGrid"></div>
            </div>
        </div>
    </div>
    
    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-poster" id="modalPoster"></div>
            <h2 class="modal-title" id="modalTitle"></h2>
            <div class="modal-info" id="modalInfo"></div>

            <div class="modal-description">
                <div class="modal-column">
                    <h3>Summary</h3>
                    <p id="modalSummary"></p>
                </div>
                <div class="modal-column">
                    <h3>Commentary</h3>
                    <p id="modalCommentary"></p>
                </div>
            </div>

            <div class="vote-buttons">
                <button class="vote-btn yes" onclick="vote('yes')">Yes</button>
                <button class="vote-btn maybe" onclick="vote('maybe')">Maybe</button>
                <button class="vote-btn veto" onclick="vote('veto')">Veto</button>
            </div>

            <button class="close-btn" onclick="closeModal()">Close</button>
        </div>
    </div>
    
    <script>
        /*
         * FIREBASE SETUP INSTRUCTIONS:
         *
         * 1. Go to https://console.firebase.google.com/
         * 2. Create a new project (or use existing one)
         * 3. Click "Add app" and select Web (</>)
         * 4. Register your app with a nickname
         * 5. Copy the firebaseConfig object from the setup page
         * 6. Replace the config below with your actual values
         * 7. Go to "Realtime Database" in the left menu
         * 8. Click "Create Database" and choose a location
         * 9. Start in "test mode" for now (you can add security rules later)
         * 10. Your database URL will be shown - make sure it matches databaseURL below
         *
         * Security Rules (optional but recommended):
         * In Firebase Console > Realtime Database > Rules, you can set:
         * {
         *   "rules": {
         *     "votes": {
         *       ".read": true,
         *       ".write": true
         *     },
         *     "suggestions": {
         *       ".read": true,
         *       ".write": true
         *     }
         *   }
         * }
         */

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAxHNFz-R9-wn_W9PQmt5gP52TDg9okrA4",
            authDomain: "movie-picker-b5645.firebaseapp.com",
            databaseURL: "https://movie-picker-b5645-default-rtdb.firebaseio.com",
            projectId: "movie-picker-b5645",
            storageBucket: "movie-picker-b5645.firebasestorage.app",
            messagingSenderId: "780505352126",
            appId: "1:780505352126:web:8bf8e38fedc3a457109bef"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const movies = [
            {
                id: 1,
                title: "Jeanne Dielman, 23 quai du Commerce, 1080 Bruxelles",
                director: "Chantal Akerman",
                year: 1975,
                poster: "https://image.tmdb.org/t/p/w500/yeL8c24oBUQSdms8f7GmRvx3DIZ.jpg",
                summary: "A lonely widowed housewife does her daily chores, takes care of her apartment where she lives with her teenage son, and turns the occasional trick to make ends meet. Slowly, her ritualized daily routines begin to fall apart.",
                commentary: "This film recently created quite a buzz 'cause it was allegedly named the greatest film of all time, to the chagrin of many male directors. I don't really know what this is all about, but its Wiki has words like 'feminist' and 'slow cinema'. Be careful with what you wish for."
            },
            {
                id: 2,
                title: "The Exterminating Angel",
                director: "Luis Buñuel",
                year: 1962,
                poster: "https://image.tmdb.org/t/p/w500/qqZXHvBFxUpo8Pfbyvgh4SYMiWm.jpg",
                summary: "After a lavish dinner party, the guests find themselves mysteriously unable to leave the room. As days pass, their behavior becomes increasingly bestial and the veneer of civilization disappears.",
                commentary: "Not gonna lie, my dream is for one day someone to say that something I made is 'Buñuelian'. I did watch this a while ago, and Cynthia keeps on quoting it even though she hasn't seen it. So maybe I can stop looking at her disapprovingly every time she does?"
            },
            {
                id: 3,
                title: "Eyes Wide Shut",
                director: "Stanley Kubrick",
                year: 1999,
                poster: "https://image.tmdb.org/t/p/w500/knEIz1eNGl5MQDbrEAVWA7iRqF9.jpg",
                summary: "After his wife admits to sexual fantasies about a man she met, a New York doctor is plunged into a harrowing nocturnal odyssey through the city's sexual underworld.",
                commentary: "We'll probably have to leave the kids back home for this one. It flirts with the 3h mark, but it is the last film of cinema's daddy."
            },
            {
                id: 4,
                title: "The Social Network",
                director: "David Fincher",
                year: 2010,
                poster: "https://image.tmdb.org/t/p/w500/n0ybibhJtQ5icDqTp8eRytcIHJx.jpg",
                summary: "The story of the founding of Facebook and the lawsuits that followed, exploring themes of friendship, betrayal, and the birth of the social media age.",
                commentary: "Hollywood at its recent-best? I've heard so. Why don't we just get acquainted with our digital overlord and see what tickles his pickle?"
            },
            {
                id: 5,
                title: "The Thin Red Line",
                director: "Terrence Malick",
                year: 1998,
                poster: "https://image.tmdb.org/t/p/w500/seMydAaoxQP6F0xbE1jOcTmn5Jr.jpg",
                summary: "A philosophical meditation on war, nature, and humanity set during the Battle of Guadalcanal in World War II, following a group of soldiers as they struggle with combat and their own mortality.",
                commentary: "I have heard it might be the Magnus Opus of one of my favorites. Sounds like a methodical dissection of the psyque of war, from the vantage point of American heros at the crux of what would be recognized as the pivotal moment that would give way to one of the most dominant empires history has ever seen. Cynthia: Young Adrien Brody is in it."
            },
            {
                id: 6,
                title: "Aguirre, the Wrath of God",
                director: "Werner Herzog",
                year: 1972,
                poster: "https://image.tmdb.org/t/p/w500/qMk93yMo82svW27FEjudgueBMUL.jpg",
                summary: "In the 16th century, Spanish soldier Lope de Aguirre leads a doomed expedition down the Amazon in search of the legendary city of gold, El Dorado. As the journey descends into madness, Aguirre's megalomania grows.",
                commentary: "Not a lot of eye-candy on this one, if you don't count the arguably best shots of the Andean Mountains ever recorded; some say one of cinema's biggest feats: A mad genius directing a lunatic in the middle of the jungle. Even the documentary on how this film was made is a film-boy's rite of passage."
            },
            {
                id: 7,
                title: "They Live",
                director: "John Carpenter",
                year: 1988,
                poster: "https://image.tmdb.org/t/p/w500/ngnybFTuopfbfmmEeX9jjBQQmF6.jpg",
                summary: "A lone drifter stumbles upon a unique pair of sunglasses that reveal aliens are systematically gaining control of the Earth by masquerading as humans and lulling the public into submission.",
                commentary: "Might be one of those that are kinda bad, but age well? The social commentary seems unfiltered, maybe even kitsch, but I am sure that with a Negroni and some of that Lettuce™ we might put on our in-door sunglasses so nobody knows what we are really seeing."
            }
        ];
        
        let currentMovie = null;
        let currentUser = null;
        
        // Check if user is already logged in
        function init() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = savedUser;
                showApp();
            }
        }
        
        function login(name) {
            currentUser = name;
            localStorage.setItem('currentUser', name);
            showApp();
        }
        
        function logout() {
            localStorage.removeItem('currentUser');
            currentUser = null;
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('app').classList.remove('active');
        }
        
        function showApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('app').classList.add('active');
            document.getElementById('userName').textContent = currentUser;
            renderMovies();

            // Set up real-time listeners for vote changes
            database.ref('votes').on('value', () => {
                // Re-render movies when any vote changes
                const currentView = document.getElementById('resultsView').classList.contains('active');
                if (currentView) {
                    renderResults();
                } else {
                    renderMovies();
                }
            });

            // Set up real-time listener for suggestions
            database.ref('suggestions').on('value', () => {
                const currentView = document.getElementById('resultsView').classList.contains('active');
                if (currentView) {
                    renderResults();
                }
            });
        }
        
        function getVotes(callback) {
            database.ref(`votes/${currentUser}`).once('value', (snapshot) => {
                const votes = snapshot.val() || {};
                callback(votes);
            });
        }

        function saveVote(movieId, choice) {
            database.ref(`votes/${currentUser}/${movieId}`).set(choice);
        }
        
        function renderMovies() {
            const grid = document.getElementById('movieGrid');

            // Save current suggestion input values before re-rendering
            const savedTitle = document.getElementById('suggestionTitle')?.value || '';
            const savedReason = document.getElementById('suggestionReason')?.value || '';

            getVotes((votes) => {
                const movieCards = movies.map(movie => {
                    const vote = votes[movie.id];
                    const badge = vote ? `<div class="vote-badge ${vote}">${vote}</div>` : '';

                    return `
                        <div class="movie-card" onclick="openModal(${movie.id})">
                            <div class="poster">
                                <img src="${movie.poster}" alt="${movie.title}">
                                ${badge}
                            </div>
                        </div>
                    `;
                }).join('');

                const suggestionCard = `
                    <div class="suggestion-card">
                        <h3>Got Ideas?</h3>
                        <input type="text" id="suggestionTitle" placeholder="Movie Title" />
                        <textarea id="suggestionReason" rows="5" placeholder="Why should we watch it?"></textarea>
                        <button onclick="submitSuggestion()">Submit</button>
                    </div>
                `;

                grid.innerHTML = movieCards + suggestionCard;

                // Restore suggestion input values after re-rendering
                if (savedTitle) document.getElementById('suggestionTitle').value = savedTitle;
                if (savedReason) document.getElementById('suggestionReason').value = savedReason;
            });
        }
        
        function openModal(movieId) {
            currentMovie = movies.find(m => m.id === movieId);

            getVotes((votes) => {
                const currentVote = votes[movieId];

                document.getElementById('modalPoster').innerHTML = `<img src="${currentMovie.poster}" alt="${currentMovie.title}">`;
                document.getElementById('modalTitle').textContent = currentMovie.title;
                document.getElementById('modalInfo').textContent = `${currentMovie.director} | ${currentMovie.year}`;
                document.getElementById('modalSummary').textContent = currentMovie.summary;
                document.getElementById('modalCommentary').textContent = currentMovie.commentary;

                // Update vote button states
                document.querySelectorAll('.vote-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                if (currentVote) {
                    const selectedBtn = document.querySelector(`.vote-btn.${currentVote}`);
                    if (selectedBtn) selectedBtn.classList.add('selected');
                }

                document.getElementById('modal').classList.add('active');
            });
        }
        
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            currentMovie = null;
        }
        
        function vote(choice) {
            saveVote(currentMovie.id, choice);
            renderMovies();
            closeModal();
        }

        function showMovies() {
            document.getElementById('movieGrid').style.display = 'grid';
            document.getElementById('resultsView').classList.remove('active');
            document.getElementById('moviesBtn').classList.add('active');
            document.getElementById('resultsBtn').classList.remove('active');
        }

        function showResults() {
            document.getElementById('movieGrid').style.display = 'none';
            document.getElementById('resultsView').classList.add('active');
            document.getElementById('moviesBtn').classList.remove('active');
            document.getElementById('resultsBtn').classList.add('active');
            renderResults();
        }

        function getAllVotes(callback) {
            database.ref('votes').once('value', (snapshot) => {
                const allVotes = snapshot.val() || {};
                callback(allVotes);
            });
        }

        function renderResults() {
            const resultsGrid = document.getElementById('resultsGrid');

            getAllVotes((allVotes) => {
                // Calculate vote counts and points for each movie
                const moviesWithScores = movies.map(movie => {
                    let yesCount = 0;
                    let maybeCount = 0;
                    let vetoCount = 0;

                    Object.values(allVotes).forEach(userVotes => {
                        const vote = userVotes[movie.id];
                        if (vote === 'yes') yesCount++;
                        else if (vote === 'maybe') maybeCount++;
                        else if (vote === 'veto') vetoCount++;
                    });

                    const totalPoints = (yesCount * 3) + (maybeCount * 1) + (vetoCount * 0);
                    const totalVotes = yesCount + maybeCount + vetoCount;

                    return {
                        ...movie,
                        yesCount,
                        maybeCount,
                        vetoCount,
                        totalPoints,
                        totalVotes
                    };
                });

                // Sort by points (descending)
                moviesWithScores.sort((a, b) => b.totalPoints - a.totalPoints);

                const resultsHTML = moviesWithScores.map(movie => {
                    const maxVotes = movie.totalVotes || 1; // Avoid division by zero
                    const yesWidth = (movie.yesCount / maxVotes) * 100;
                    const maybeWidth = (movie.maybeCount / maxVotes) * 100;
                    const vetoWidth = (movie.vetoCount / maxVotes) * 100;

                    return `
                        <div class="results-movie">
                            <div class="results-poster">
                                <img src="${movie.poster}" alt="${movie.title}">
                            </div>
                            <div class="results-bars">
                                <div class="results-bar">
                                    <span class="bar-label">Yes</span>
                                    <div class="bar-track">
                                        <div class="bar-fill yes" style="width: ${yesWidth}%"></div>
                                    </div>
                                    <span class="bar-count">${movie.yesCount}</span>
                                </div>
                                <div class="results-bar">
                                    <span class="bar-label">Maybe</span>
                                    <div class="bar-track">
                                        <div class="bar-fill maybe" style="width: ${maybeWidth}%"></div>
                                    </div>
                                    <span class="bar-count">${movie.maybeCount}</span>
                                </div>
                                <div class="results-bar">
                                    <span class="bar-label">Veto</span>
                                    <div class="bar-track">
                                        <div class="bar-fill veto" style="width: ${vetoWidth}%"></div>
                                    </div>
                                    <span class="bar-count">${movie.vetoCount}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                resultsGrid.innerHTML = resultsHTML;

                // Render suggestions
                getSuggestions((suggestions) => {
                    if (suggestions.length > 0) {
                        const suggestionsHTML = `
                            <div class="suggestions-section">
                                <h2>Suggestions</h2>
                                ${suggestions.map(suggestion => `
                                    <div class="suggestion-item">
                                        <div class="suggestion-title">${suggestion.title}</div>
                                        <div class="suggestion-reason">${suggestion.reason}</div>
                                        <div class="suggestion-author">— ${suggestion.author}</div>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                        resultsGrid.innerHTML += suggestionsHTML;
                    }
                });
            });
        }

        function submitSuggestion() {
            const title = document.getElementById('suggestionTitle').value.trim();
            const reason = document.getElementById('suggestionReason').value.trim();

            if (!title || !reason) {
                alert('Please fill in both fields');
                return;
            }

            const newSuggestion = {
                title: title,
                reason: reason,
                author: currentUser,
                timestamp: Date.now()
            };

            database.ref('suggestions').push(newSuggestion);

            // Clear the inputs
            document.getElementById('suggestionTitle').value = '';
            document.getElementById('suggestionReason').value = '';

            alert('Suggestion submitted!');
        }

        function getSuggestions(callback) {
            database.ref('suggestions').once('value', (snapshot) => {
                const suggestionsObj = snapshot.val() || {};
                const suggestions = Object.values(suggestionsObj);
                callback(suggestions);
            });
        }

        // Initialize app
        init();
    </script>
</body>
</html>